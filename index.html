<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liz 2026 - Ambient Stock</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body { font-family: sans-serif; text-align: center; background: #f0f2f5; margin: 0; padding: 10px; }
        .header { background: #2c3e50; color: white; padding: 15px; border-radius: 0 0 15px 15px; margin-bottom: 20px; }
        #reader { width: 100%; max-width: 400px; margin: auto; border-radius: 10px; overflow: hidden; border: 3px solid #34495e; }
        .result-table { width: 100%; max-width: 400px; margin: 20px auto; background: white; border-collapse: collapse; border-radius: 8px; overflow: hidden; }
        .result-table th, .result-table td { padding: 12px; border-bottom: 1px solid #eee; text-align: left; }
        .btn-download { background: #27ae60; color: white; padding: 15px 30px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; width: 100%; max-width: 400px; cursor: pointer; }
    </style>
</head>
<body>

<div class="header">
    <h1>Liz 2026</h1>
    <p>Main Kitchen New Ambient</p>
</div>

<div id="reader"></div>

<table class="result-table">
    <thead>
        <tr style="background: #ecf0f1;">
            <th>Barcode</th>
            <th>Qty</th>
        </tr>
    </thead>
    <tbody id="inventory-body">
        </tbody>
</table>

<button class="btn-download" onclick="exportToCSV()">ðŸ’¾ Save Stock List</button>

<script>
    let stock = {}; // Using an object to prevent duplicate rows for the same barcode

    function onScanSuccess(decodedText) {
        // Vibrate phone on success
        if (navigator.vibrate) navigator.vibrate(100);

        let qty = prompt(`Barcode: ${decodedText}\nEnter Quantity:`, "1");
        
        if (qty !== null && !isNaN(qty)) {
            // Add to our list (adds to existing if scanned twice)
            stock[decodedText] = (stock[decodedText] || 0) + parseInt(qty);
            updateTable();
        }
    }

    function updateTable() {
        const body = document.getElementById('inventory-body');
        body.innerHTML = "";
        for (const [code, count] of Object.entries(stock)) {
            body.innerHTML += `<tr><td>${code}</td><td><b>${count}</b></td></tr>`;
        }
    }

    function exportToCSV() {
        if (Object.keys(stock).length === 0) return alert("Scan something first!");
        let csv = "Barcode,Quantity\n";
        for (const [code, count] of Object.entries(stock)) {
            csv += `${code},${count}\n`;
        }
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `Stock_Scan_${new Date().toLocaleDateString()}.csv`;
        a.click();
    }

    const scanner = new Html5QrcodeScanner("reader", { fps: 10, qrbox: 250 });
    scanner.render(onScanSuccess);
</script>

</body>
</html>
