<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Liz Stock Take - V5</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://unpkg.com/@zxing/library@latest"></script>
    <style>
        body { font-family: sans-serif; margin: 0; padding: 10px; background: #f4f7f6; }
        .card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 10px; }
        .btn { border: none; border-radius: 8px; padding: 15px; font-weight: bold; cursor: pointer; width: 100%; margin-bottom: 10px; }
        .btn-blue { background: #1a73e8; color: white; }
        .btn-area { background: white; border: 1px solid #1a73e8; color: #1a73e8; width: 47%; display: inline-block; font-size: 11px; min-height: 45px; margin: 1%; vertical-align: top; }
        .active { background: #1a73e8 !important; color: white !important; }
        .item { padding: 15px; background: white; border-radius: 10px; margin-bottom: 8px; border-left: 5px solid #1a73e8; display: flex; justify-content: space-between; align-items: center; }
        #results { margin-top: 15px; padding-bottom: 110px; }
        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px; box-sizing: border-box; }
    </style>
</head>
<body>

<div id="setup" class="card">
    <h3 id="app-title">Liz Stock Take - V5</h3>
    <input type="text" id="userName" placeholder="Numele tau">
    <input type="file" id="fileInput" accept=".xlsx" onchange="processFile(this)">
    <div id="status" style="margin: 10px 0; font-weight: bold; color: green;"></div>
    <button id="startBtn" class="btn btn-blue" style="display:none" onclick="document.getElementById('setup').style.display='none'; document.getElementById('app').style.display='block';">DESCHIDE APLICATIA</button>
</div>

<div id="app" style="display:none">
    <div id="buttons" class="card"></div>
    <input type="text" id="search" placeholder="Cauta produs..." oninput="renderList()">
    <div id="results"></div>
</div>

<script>
let data = []; let logs = {}; let currentArea = "";

function processFile(el) {
    const reader = new FileReader();
    reader.onload = (e) => {
        const wb = XLSX.read(new Uint8Array(e.target.result), {type: 'array'});
        data = [];
        const btnDiv = document.getElementById('buttons');
        btnDiv.innerHTML = "";
        
        wb.SheetNames.forEach(name => {
            if(name.toLowerCase().includes("summary")) return;
            let b = document.createElement('button');
            b.className = 'btn btn-area';
            b.innerText = name;
            b.onclick = () => {
                document.querySelectorAll('.btn-area').forEach(x => x.classList.remove('active'));
                b.classList.add('active');
                currentArea = name;
                renderList();
            };
            btnDiv.appendChild(b);
            
            let sheet = XLSX.utils.sheet_to_json(wb.Sheets[name], {header: 1});
            sheet.forEach(row => {
                let pName = String(row[2] || "").trim(); // Coloana C
                let pCode = String(row[1] || "").trim(); // Coloana B
                if(pName.length > 2 && pName.toLowerCase() !== "produs") {
                    data.push({ n: pName, c: pCode, a: name });
                }
            });
        });
        document.getElementById('status').innerText = "Gata! " + data.length + " produse.";
        document.getElementById('startBtn').style.display = "block";
    };
    reader.readAsArrayBuffer(el.files[0]);
}

function renderList() {
    let term = document.getElementById('search').value.toLowerCase();
    let filtered = data.filter(x => x.a === currentArea && x.n.toLowerCase().includes(term));
    document.getElementById('results').innerHTML = filtered.map(i => `
        <div class="item" onclick="addQty('${i.n}')">
            <div><b>${i.n}</b><br><small>${i.c}</small></div>
            <div style="color: blue; font-weight: bold;">${logs[i.n] || '+'}</div>
        </div>
    `).join('');
}

function addQty(name) {
    let q = prompt("Cantitate pentru: " + name);
    if(q !== null && !isNaN(parseFloat(q))) {
        logs[name] = (logs[name] || 0) + parseFloat(q);
        renderList();
    }
}
</script>
</body>
</html>
