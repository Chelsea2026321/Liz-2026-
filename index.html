<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Liz Inventory V7 - FINAL</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { font-family: sans-serif; margin: 0; padding: 15px; background: #f4f7f6; color: #333; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 15px; }
        .btn { border: none; border-radius: 8px; padding: 15px; font-weight: bold; cursor: pointer; width: 100%; margin-bottom: 10px; font-size: 16px; }
        .btn-blue { background: #1a73e8; color: white; }
        .btn-green { background: #34a853; color: white; position: fixed; bottom: 10px; left: 10px; width: calc(100% - 20px); height: 60px; z-index: 100; }
        .area-btn { background: white; border: 1px solid #1a73e8; color: #1a73e8; width: 47%; display: inline-block; font-size: 11px; min-height: 45px; margin: 1%; vertical-align: top; border-radius: 6px; }
        .active { background: #1a73e8 !important; color: white !important; }
        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; margin-top: 10px; }
        #results { margin-top: 15px; padding-bottom: 110px; }
        .item { padding: 15px; background: white; border-radius: 10px; margin-bottom: 8px; border-left: 5px solid #1a73e8; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .prod-name { font-weight: bold; font-size: 15px; color: #1a73e8; text-align: left; flex: 1; }
        .qty-display { font-weight: bold; font-size: 18px; margin-left: 10px; color: #333; }
    </style>
</head>
<body>

<div id="setup-screen" class="card">
    <h2 style="margin-top:0;">Liz Inventory V7</h2>
    <input type="text" id="userName" placeholder="Numele tÄƒu">
    <p style="font-size: 14px; color: #666;">ÃŽncarcÄƒ fiÈ™ierul Excel pentru a Ã®ncepe:</p>
    <input type="file" id="fileInput" accept=".xlsx" onchange="processFile(this)">
    <div id="file-status" style="margin-top:10px; font-weight: bold; color: #34a853;"></div>
    <button id="startBtn" class="btn btn-blue" style="display:none; margin-top:15px;" onclick="startApp()">DESCHIDE LISTA</button>
</div>

<div id="main-app" style="display:none">
    <div id="category-buttons" class="card" style="text-align:center"></div>
    <input type="text" id="searchInput" placeholder="CautÄƒ produs..." oninput="renderList()">
    <div id="results">ApasÄƒ pe o categorie de mai sus</div>
</div>

<button id="downloadBtn" class="btn btn-green" style="display:none" onclick="exportExcel()">ðŸ’¾ DESCARCÄ‚ EXCEL FINAL</button>

<script>
let masterData = []; let logs = {}; let currentArea = "";

function processFile(input) {
    const reader = new FileReader();
    reader.onload = (e) => {
        try {
            const data = new Uint8Array(e.target.result);
            const wb = XLSX.read(data, {type: 'array'});
            masterData = [];
            const btnContainer = document.getElementById('category-buttons');
            btnContainer.innerHTML = "";
            
            wb.SheetNames.forEach(sheetName => {
                if(sheetName.toLowerCase().includes("summary")) return;
                
                // CreÄƒm butoanele pentru categorii
                let b = document.createElement('button');
                b.className = 'area-btn';
                b.innerText = sheetName;
                b.onclick = () => {
                    document.querySelectorAll('.area-btn').forEach(x => x.classList.remove('active'));
                    b.classList.add('active');
                    currentArea = sheetName;
                    renderList();
                };
                btnContainer.appendChild(b);
                
                // Citim datele din fiecare foaie
                let rows = XLSX.utils.sheet_to_json(wb.Sheets[sheetName], {header: 1});
                rows.forEach(r => {
                    // CÄƒutÄƒm denumirea Ã®n coloana C (index 2) sau B (index 1)
                    let name = String(r[2] || r[1] || "").trim();
                    if(name.length > 2 && name.toLowerCase() !== "produs" && name.toLowerCase() !== "product") {
                        masterData.push({ n: name, a: sheetName });
                    }
                });
            });
            
            document.getElementById('file-status').innerText = "âœ… " + masterData.length + " produse Ã®ncÄƒrcate!";
            document.getElementById('startBtn').style.display = "block";
        } catch (err) {
            alert("Eroare la citirea Excel-ului!");
        }
    };
    reader.readAsArrayBuffer(input.files[0]);
}

function startApp() {
    if(!document.getElementById('userName').value) return alert("Introdu numele tÄƒu!");
    document.getElementById('setup-screen').style.display = "none";
    document.getElementById('main-app').style.display = "block";
    document.getElementById('downloadBtn').style.display = "block";
}

function renderList() {
    let term = document.getElementById('searchInput').value.toLowerCase();
    let filtered = masterData.filter(x => x.a === currentArea && x.n.toLowerCase().includes(term));
    
    let div = document.getElementById('results');
    div.innerHTML = filtered.map(i => `
        <div class="item" onclick="addQuantity('${i.n.replace(/'/g, "\\'")}')">
            <span class="prod-name">${i.n}</span>
            <span class="qty-display">${logs[i.n] || '+'}</span>
        </div>
    `).join('');
}

function addQuantity(name) {
    let val = prompt("Introdu cantitatea pentru:\n" + name);
    if(val !== null && val !== "" && !isNaN(val)) {
        logs[name] = (logs[name] || 0) + parseFloat(val);
        renderList();
    }
}

function exportExcel() {
    const keys = Object.keys(logs);
    if(keys.length === 0) return alert("Nu ai introdus nicio cantitate!");
    
    const userName = document.getElementById('userName').value;
    const exportData = keys.map(k => {
        let item = masterData.find(m => m.n === k);
        return { Personal: userName, Zona: item ? item.a : "", Produs: k, Cantitate: logs[k] };
    });
    
    const ws = XLSX.utils.json_to_sheet(exportData);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Inventar");
    XLSX.writeFile(wb, `Inventar_${userName}.xlsx`);
}
</script>
</body>
</html>
