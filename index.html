<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liz 2026 - All-in-One Tool</title>
    <script src="https://unpkg.com/@ericblade/quagga2/dist/quagga.min.js"></script>
    <script src="https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js"></script>
    <style>
        body { font-family: sans-serif; padding: 10px; background: #f0f2f5; margin: 0; }
        .section { background: white; padding: 15px; border-radius: 12px; margin-bottom: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h3 { margin-top: 0; color: #1a73e8; font-size: 16px; }
        
        /* Butoane */
        button { width: 100%; padding: 12px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; margin-bottom: 5px; }
        .btn-blue { background: #1a73e8; color: white; }
        .btn-orange { background: #f9ab00; color: black; }
        .btn-purple { background: #673ab7; color: white; }
        .btn-green { background: #1e8e3e; color: white; margin-top: 10px; }
        
        #scanner-container { width: 100%; height: 160px; background: #000; border-radius: 8px; display: none; margin-bottom: 10px; }
        textarea { width: 100%; height: 60px; border: 1px solid #ccc; border-radius: 5px; font-size: 12px; }
        #ocr-status { font-size: 12px; color: #666; margin-top: 5px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 11px; }
        th, td { border: 1px solid #ddd; padding: 6px; text-align: left; }
        th { background: #eee; }
    </style>
</head>
<body>

    <div class="section">
        <h3>1. Setup Data</h3>
        <button class="btn-orange" onclick="document.getElementById('manualBox').style.display='block'">+ Paste Master List (Text)</button>
        <div id="manualBox" style="display:none;">
            <textarea id="manualData" placeholder="Paste CSV rows here..."></textarea>
            <button onclick="processTextData()" style="background:#666; color:white; padding:5px; font-size:11px;">Process Text</button>
        </div>
        <div id="dataStatus" style="font-size:11px; margin-top:5px; font-weight:bold;">Status: Waiting for data...</div>
    </div>

    <div class="section">
        <h3>2. Inventory Methods</h3>
        <button class="btn-blue" onclick="startScanner()">üì∑ SCAN BARCODE</button>
        <div id="scanner-container"></div>
        
        <hr>
        
        <button class="btn-purple" onclick="document.getElementById('ocrInput').click()">üìù PHOTO OF HANDWRITTEN LIST</button>
        <input type="file" id="ocrInput" accept="image/*" capture="environment" style="display:none;">
        <div id="ocr-status"></div>
    </div>

    <div class="section">
        <h3>3. Stock List</h3>
        <table id="stockTable">
            <thead><tr><th>Item</th><th>Qty</th><th>Barcode/Note</th></tr></thead>
            <tbody></tbody>
        </table>
        <button class="btn-green" onclick="downloadReport()">üíæ DOWNLOAD EXCEL (CSV)</button>
    </div>

    <script>
        let masterList = [];
        let finalStock = [];

        // --- 1. DATA LOGIC ---
        function processTextData() {
            const text = document.getElementById('manualData').value;
            masterList = text.split('\n').map(row => row.split(',').map(c => c.trim()));
            document.getElementById('dataStatus').innerText = "‚úÖ Data Loaded!";
            document.getElementById('dataStatus').style.color = "green";
            document.getElementById('manualBox').style.display = 'none';
        }

        // --- 2. BARCODE SCANNER ---
        function startScanner() {
            document.getElementById('scanner-container').style.display = 'block';
            Quagga.init({
                inputStream: { name: "Live", type: "LiveStream", target: document.querySelector('#scanner-container'), constraints: { facingMode: "environment" } },
                decoder: { readers: ["ean_reader", "code_128_reader"] }
            }, function(err) {
                if (!err) Quagga.start();
            });

            Quagga.onDetected(data => {
                let code = data.codeResult.code;
                Quagga.stop();
                document.getElementById('scanner-container').style.display = 'none';
                window.navigator.vibrate(100);
                
                let match = masterList.find(r => r.join('').includes(code));
                let name = match ? match[1] : "New Item";
                let qty = prompt(`Found: ${name}\nEnter Quantity:`, "1");
                
                if(qty) {
                    finalStock.push({ name: name, qty: qty, note: code });
                    updateTable();
                }
            });
        }

        // --- 3. OCR (PHOTO TO TEXT) ---
        document.getElementById('ocrInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            document.getElementById('ocr-status').innerText = "Processing image... Please wait.";
            
            Tesseract.recognize(file, 'eng').then(({ data: { text } }) => {
                document.getElementById('ocr-status').innerText = "Scan complete!";
                let lines = text.split('\n').filter(l => l.trim().length > 2);
                lines.forEach(line => {
                    finalStock.push({ name: line, qty: "Review", note: "From Photo" });
                });
                updateTable();
            });
        });

        function updateTable() {
            const tbody = document.querySelector('#stockTable tbody');
            tbody.innerHTML = finalStock.map(i => `<tr><td>${i.name}</td><td>${i.qty}</td><td>${i.note}</td></tr>`).join('');
        }

        function downloadReport() {
            let csv = "Item,Qty,Note\n" + finalStock.map(i => `"${i.name}","${i.qty}","${i.note}"`).join('\n');
            let blob = new Blob([csv], { type: 'text/csv' });
            let url = URL.createObjectURL(blob);
            let a = document.createElement('a');
            a.href = url;
            a.download = 'inventory_report.csv';
            a.click();
        }
    </script>
</body>
</html>
